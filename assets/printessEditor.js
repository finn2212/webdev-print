/*Printess Shopify Integration Version: 2.4*/var __awaiter=this&&this.__awaiter||function(e,s,a,d){return new(a=a||Promise)(function(i,t){function o(e){try{n(d.next(e))}catch(e){t(e)}}function r(e){try{n(d.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,r)}n((d=d.apply(e,s||[])).next())})};class PrintessEditor{constructor(e,t,i,o,r,n="",s=""){this.Context={},this.Overflow={x:"auto",y:"auto"},this.ShopToken="",this.calculateCurrentPrices=e=>{var t=this.getPriceCategories();let i=this.Context.getPriceForFormFields(this.Context.getCurrentFormFieldValues());return e.snippetPriceCategories&&e.snippetPriceCategories.forEach(e=>{e&&0<e.amount&&this.Context.snippetPrices[e.priceCategory-1]&&(i+=this.Context.snippetPrices[e.priceCategory-1].priceInCent)}),t.price=this.Context.formatMoney(i),t},this.ShopToken=e;e={showAnimation:!0===r||"true"==r},this.EditorUrl=this.getEditorUrl(t,i,e),r=o||"";r&&(e.imageUrl=r),s&&(e.background=s),this.EditorUrl=this.EditorUrl+"#"+encodeURIComponent(JSON.stringify(e)),this.theme=n||""}getEditorUrl(e,t,i){var o=(e=e||"https://editor.printess.com/").indexOf("#");if(0<o){var r=e.substring(o+1);if(r)try{var n=JSON.parse(decodeURIComponent(r));if(n)for(var s in n)n.hasOwnProperty(s)&&(i[s]=n[s])}catch(e){}e=e.substring(0,o)}return e.toLowerCase().endsWith(".html")||(e=this.sanitizeHost(e),t&&(e+=(t=this.stripEditorVersion(t))+(t?"/":"")),e+="printess-editor/embed.html"),e}stripEditorVersion(e){if(void 0!==(e=(e||"").trim())&&null!=e)if(e){for(;0==e.indexOf("/");)e=e.substring(1);for(;0<e.length&&"/"===e[e.length-1];)e=e.substring(0,e.length-1)}else e="";return e}sanitizeHost(e){return e?(e=e.trim()).endsWith("/")?e:e+"/":e||""}getPriceCategories(){return{snippetPrices:this.Context.snippetPrices.map(e=>e?e.label:null),priceCategories:{},price:this.Context.formatMoney(this.Context.getPriceForFormFields(this.Context.getCurrentFormFieldValues())),productName:this.Context.getProductName(),legalNotice:this.Context.legalText,infoUrl:this.Context.legalTextUrl}}onPriceChanged(t){try{const i=document.getElementById("printess");let e=null;try{t.snippetPriceCategories&&0<t.snippetPriceCategories.length?this.Context.stickers=t.snippetPriceCategories.filter(e=>this.Context.snippetPrices&&this.Context.snippetPrices.length>=e.priceCategory).map(e=>({productVariantId:this.Context.snippetPrices[e.priceCategory-1].variantId,quantity:e.amount})):this.Context.stickers=[],e=this.calculateCurrentPrices(t)}catch(e){console.error(e)}i&&!this.Context.hidePricesInEditor&&setTimeout(()=>{i.contentWindow.postMessage({cmd:"refreshPriceDisplay",priceDisplay:e},"*")},0)}catch(e){}}hideEditor(e=!1){try{var t=document.getElementById("printess-container"),i=(t&&(t.style.display="none"),document.body.style.overflowX=this.Overflow.x.toString(),document.body.style.overflowY=this.Overflow.y.toString(),document.body.classList.remove("hideAll"),document.getElementsByTagName("html"));i&&0<i.length&&i[0].classList.remove("printessEditorOpen"),window.removeEventListener("beforeunload",this.closeTabHandler),window.removeEventListener("unload",this.closeTabHandler)}catch(e){}"function"==typeof this.Context.editorClosed&&this.Context.editorClosed(e)}getOrCreateIframe(e){const o=this;let t=document.getElementById("printess");if(t){if("function"==typeof e)try{e(t)}catch(e){console.error(e)}}else{var i=document.createElement("div");i.setAttribute("id","printess-container"),i.setAttribute("style","display: none; position: absolute; top: 0; bottom: 0; right: 0; left: 0; width: 100%; height: 100%; z-index: 100000;"),(t=document.createElement("iframe")).setAttribute("src",this.EditorUrl),t.setAttribute("id","printess"),t.setAttribute("style","width:100%; heigth:100%;"),t.setAttribute("data-attached","false"),t.setAttribute("allow","xr-spatial-tracking; clipboard-read; clipboard-write;"),t.setAttribute("allowfullscreen","true"),i.appendChild(t),t.onload=()=>{if("function"==typeof e)try{e(t)}catch(e){console.error(e)}},window.addEventListener("message",i=>__awaiter(this,void 0,void 0,function*(){switch(i.data.cmd){case"back":o.hideEditor();break;case"basket":const t=o.Context.onAddToBasket(i.data.token,i.data.thumbnailUrl);t&&t.waitUntilClosingMS?setTimeout(function(){"function"==typeof t.executeBeforeClosing&&t.executeBeforeClosing(),o.hideEditor()},t.waitUntilClosingMS):(t&&"function"==typeof t.executeBeforeClosing&&t.executeBeforeClosing(),o.hideEditor());break;case"formFieldChanged":var e=o.reverseFormFieldMapping(i.data.n||i.data.name,i.data.v||i.data.value,this.Context.getFormFieldMappings());o.Context.onFormFieldChanged(e.name,e.value,i.data.ffCaption||"",i.data.l||i.data.label);break;case"priceChanged":o.onPriceChanged(i.data.priceInfo);break;case"renderFirstPageImage":"function"==typeof o.Context.onRenderFirstPageImage&&o.Context.onRenderFirstPageImage(i.data.result);break;case"save":"function"==typeof o.Context.onSave&&o.Context.onSave(i.data.token,i.data.thumbnailUrl)}})),window.visualViewport&&window.visualViewport.addEventListener("scroll",()=>{var e;null!=(e=t.contentWindow)&&e.postMessage({cmd:"viewportScroll",height:null==(e=window.visualViewport)?void 0:e.height,offsetTop:null==(e=window.visualViewport)?void 0:e.offsetTop},"*")},{passive:!0}),document.body.append(i)}return t}applyFormFieldMappings(t,i){var o=[];if(!i)for(const e in t)t.hasOwnProperty(e)&&o.push({name:e,value:t[e]});if(t)for(const s in t)if(t.hasOwnProperty(s)){var r=t[s],n=void 0!==i[s]&&void 0!==i[s].formField?i[s].formField:s;let e=r;void 0!==i[s]&&void 0!==i[s].values&&void 0!==i[s].values[e]&&(e=i[s].values[r]),o.push({name:n,value:e})}return o}reverseFormFieldMapping(e,t,i){let o=e||"",r=t||"";if(i)for(var n in i)if(i.hasOwnProperty(n)&&i[n].formField===e){if(i[o=n].values)for(var s in i[n].values)if(i[n].values.hasOwnProperty(s)&&i[n].values[s]===t){r=s;break}break}return{name:o,value:r}}setViewportMeta(){var i=document.getElementsByTagName("head");if(i&&0<i.length){let e=i[0].querySelector("meta[name=viewport]"),t=(e||((e=document.createElement("meta")).setAttribute("name","viewport"),i[0].appendChild(e)),e.getAttribute("content"));t?t.indexOf("interactive-widget")<0&&(t=t+(t?", ":"")+"interactive-widget=resizes-content",e.setAttribute("content",t)):e.setAttribute("content","interactive-widget=resizes-content")}}closeTabHandler(e){e.preventDefault(),e.returnValue=""}show(s){this.Context=s;let a=!(this.Context.stickers=[]);try{this.setViewportMeta()}catch(e){console.error(e)}s&&s.templateNameOrSaveToken&&(a=0===s.templateNameOrSaveToken.indexOf("st:")&&90===s.templateNameOrSaveToken.length),this.getOrCreateIframe(e=>{var t=s.getPriceInfo();let i=null,o=null;if(a||(i=this.applyFormFieldMappings(this.Context.getCurrentFormFieldValues(),s.getFormFieldMappings()),o=this.Context.getMergeTemplates()),this.showTabClosingAlert&&(window.addEventListener("beforeunload",this.closeTabHandler),window.addEventListener("unload",this.closeTabHandler)),"false"===e.getAttribute("data-attached"))try{var r={token:this.ShopToken,templateName:s.templateNameOrSaveToken,showBuyerSide:!0,templateUserId:"",basketId:"function"==typeof this.Context.getBasketId&&this.Context.getBasketId()||"Some-Unique-Basket-Or-Session-Id",shopUserId:"function"==typeof this.Context.getUserId?this.Context.getUserId()||"Some-Unique-Basket-Or-Session-Id":"Some-Unique-Shop-User-Id",formFields:i,snippetPriceCategoryLabels:t&&t.snippetPrices?t.snippetPrices:null,mergeTemplates:o};if(void 0!==s.showSplitterGridSizeButton&&null!==s.showSplitterGridSizeButton&&(r.showSplitterGridSizeButton=!0===s.showSplitterGridSizeButton||"true"===s.showSplitterGridSizeButton),this.theme&&(r.theme=this.theme),void 0!==s.additionalAttachParams||null!==s.additionalAttachParams)for(const n in s.additionalAttachParams)s.additionalAttachParams.hasOwnProperty(n)&&(r[n]=s.additionalAttachParams[n]);e.contentWindow.postMessage({cmd:"attach",properties:r},"*"),e.setAttribute("data-attached","true")}catch(e){console.error(e)}else e.contentWindow.postMessage({cmd:"loadTemplateAndFormFields",parameters:[s.templateNameOrSaveToken,o,i,void 0]},"*")}),this.Overflow.x=document.body.style.overflowX,this.Overflow.y=document.body.style.overflowY,document.body.style.overflowX="hidden",document.body.style.overflowY="hidden",document.body.classList.add("hideAll");var e=document.getElementsByTagName("html"),e=(e&&0<e.length&&e[0].classList.add("printessEditorOpen"),document.getElementById("printess-container"));e&&e.style.setProperty("display","block","important")}}function initPrintessEditor(e,t,i,o,r,n,s=""){let a=!1;var d;return window.printessEditor&&window.printessEditor.show||("string"!=typeof e&&(e=(d=e).shopToken||"",t=d.editorUrl||"",i=d.editorVersion||"",o=d.startupLogoUrl||"",r=void 0===d.showStartupAnimation||!0===d.showStartupAnimation,n=void 0===d.theme?"":d.theme,s=void 0===d.startupBackgroundColor?"":d.startupBackgroundColor,a=void 0!==d.showAlertOnTabClose&&!0===d.showAlertOnTabClose),d=new PrintessEditor(e||"",t||"",i||"",o||"",!0===r,n||"",s),(window.printessEditor=d).showTabClosingAlert=a),window.printessEditor};